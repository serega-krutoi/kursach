#include <iostream>
#include <vector>
#include "model.h"
#include "validator.h"
#include "generator.h"
#include "logger.h"

// ГРУППЫ
std::vector<Group> groups = {
    {1, "ИС-31", 22},
    {2, "ИС-32", 28},
    {3, "ПО-41", 30},
    {4, "ПО-42", 18},
    {5, "КС-21", 25}
};

// ПРЕПОДАВАТЕЛИ
std::vector<Teacher> teachers = {
    {1, "Иванов И.И.", "Алгоритмы и структуры данных"},
    {2, "Петров П.П.", "Компьютерные сети"},
    {3, "Сидоров С.С.", "Базы данных"},
    {4, "Кузнецов К.К.", "Операционные системы"},
    {5, "Фёдоров Ф.Ф.", "Информационная безопасность"}
};

// АУДИТОРИИ
std::vector<Room> rooms = {
    {1, "Аудитория 101", 20},
    {2, "Аудитория 202", 30},
    {3, "Аудитория 303", 40}
};

// ПРЕДМЕТЫ (с разной сложностью: 1 — легко, 5 — очень сложно)
std::vector<Subject> subjects = {
    {1, "Алгоритмы и структуры данных", 4},   // сложный
    {2, "Компьютерные сети", 3},
    {3, "Базы данных", 3},
    {4, "Операционные системы", 4},           // сложный
    {5, "Информационная безопасность", 5},    // самый сложный
    {6, "Проектирование ПО", 2},
    {7, "Математический анализ", 5},          // очень сложный
    {8, "Дискретная математика", 4}
};

// ТАЙМСЛОТЫ (4 дня сессии, по 2 слота в день)
std::vector<Timeslot> timeslots = {
    // 20 января
    {1, "2025-01-20",  9*60, 11*60},   // 09:00–11:00
    {2, "2025-01-20", 12*60, 14*60},   // 12:00–14:00

    // 21 января
    {3, "2025-01-21",  9*60, 11*60},
    {4, "2025-01-21", 12*60, 14*60},

    // 22 января
    {5, "2025-01-22",  9*60, 11*60},
    {6, "2025-01-22", 12*60, 14*60},

    // 23 января
    {7, "2025-01-23",  9*60, 11*60},
    {8, "2025-01-23", 12*60, 14*60}
};

// ЭКЗАМЕНЫ (примерно по 2–3 на группу, разные преподы и предметы)
std::vector<Exam> exams = {
    // Группа ИС-31
    {0, 1, 1, 1, 120},  // Алгоритмы и СД (сложный), препод 1
    {1, 1, 2, 2, 90},   // Компьютерные сети, препод 2
    {2, 1, 3, 3, 90},   // Базы данных, препод 3

    // Группа ИС-32
    {3, 2, 1, 1, 120},  // Алгоритмы и СД, препод 1
    {4, 2, 4, 4, 90},   // Операционные системы, препод 4

    // Группа ПО-41
    {5, 3, 3, 6, 90},   // Проектирование ПО, препод 3
    {6, 3, 5, 5, 120},  // Инф. безопасность, препод 5
    {12, 3, 1, 1, 120},  // Алгоритмы и СД, препод 1

    // Группа ПО-42
    {7, 4, 2, 2, 90},   // Компьютерные сети
    {8, 4, 3, 3, 90},   // Базы данных

    // Группа КС-21
    {9, 5, 1, 7, 120},  // Математический анализ (очень сложный), препод 1
    {10, 5, 4, 8, 90},  // Дискретная математика, препод 4

    // Дополнительный экзамен для нагрузки
    {11, 3, 1, 1, 120}  // Алгоритмы и СД для ПО-41, препод 1
};

std::string sessionStart = "2025-01-20";
std::string sessionEnd   = "2025-01-23";
int maxExamsPerDayForGroup = 2; // например, не больше 2 экзаменов в день на группу


int main() {
    // сюда вставляешь те вектора, что выше:
    // groups, teachers, rooms, subjects, timeslots, exams

    // 1. Генерация расписания
    std::vector<ExamAssignment> assignments = generateSchedule(
        exams,
        groups,
        subjects,
        timeslots,
        rooms
    );

    std::cout << "Сгенерированное расписание:\n";
    for (const ExamAssignment& a : assignments) {
        const Exam& e = exams[a.examIndex];
        std::cout << "Exam id=" << e.id
                  << " groupId=" << e.groupId
                  << " teacherId=" << e.teacherId
                  << " timeslotId=" << a.timeslotId
                  << " roomId=" << a.roomId << "\n";
    }

    // 2. Валидация
    ScheduleValidator validator;

    std::string sessionStart = "2025-01-20";
    std::string sessionEnd   = "2025-01-23";
    int maxExamsPerDayForGroup = 2;

    ValidationResult res = validator.checkAll(
        exams,
        groups,
        teachers,
        rooms,
        timeslots,
        assignments,
        sessionStart,
        sessionEnd,
        maxExamsPerDayForGroup
    );

    std::cout << "\nРезультат проверки:\n";
    if (!res.ok) {
        for (const std::string& err : res.errors) {
            std::cout << " - " << err << "\n";
        }
    } else {
        std::cout << "Расписание корректно.\n";
    }

    return 0;
}

